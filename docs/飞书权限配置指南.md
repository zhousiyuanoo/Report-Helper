# 飞书权限配置指南

## 问题描述

当您在飞书设置中填写了正确的 App ID 和 App Secret 后，连接测试仍然失败，提示"网络连接失败或API异常"，这通常是因为飞书应用缺少必要的API权限。

## 错误分析

根据测试结果，您的 App ID 和 App Secret 是正确的，访问令牌获取成功，但API调用失败，错误信息显示：

```
应用尚未开通所需的应用身份权限：
- im:chat:readonly (获取群组信息-只读)
- im:chat (发送消息到群组)
- im:chat.group_info:readonly (获取群组详细信息-只读)
- im:chat:read (读取群组消息)
```

## 解决方案

### 步骤1：登录飞书开放平台

1. 访问 [飞书开放平台](https://open.feishu.cn/)
2. 使用您的飞书账号登录
3. 进入 [应用管理](https://open.feishu.cn/app/)

### 步骤2：找到您的应用

1. 在应用列表中找到您创建的应用
2. 点击应用名称进入应用详情页面

### 步骤3：配置API权限

1. 在左侧导航栏中点击 **"权限管理"**
2. 选择 **"API权限"** 标签页
3. 搜索并添加以下权限：

#### 必需权限列表：

| 权限名称 | 权限标识 | 用途 |
|---------|---------|------|
| 获取群组信息 | `im:chat:readonly` | 获取群聊基本信息 |
| 发送消息 | `im:chat` | 发送汇报消息到群聊 |
| 获取群组详细信息 | `im:chat.group_info:readonly` | 获取群聊详细信息 |
| 读取消息 | `im:chat:read` | 读取群聊消息（可选） |

#### 添加权限的具体步骤：

1. 点击 **"添加权限"** 按钮
2. 在搜索框中输入权限名称或标识
3. 找到对应权限后点击 **"添加"**
4. 重复以上步骤添加所有必需权限

### 步骤4：申请权限审核

1. 添加完所有权限后，点击 **"提交审核"**
2. 填写权限申请理由，例如：
   ```
   用于工作汇报自动化，需要向指定群聊发送日报、周报、月报等工作汇报内容
   ```
3. 提交申请并等待审核通过

### 步骤5：发布应用版本

1. 权限审核通过后，进入 **"版本管理与发布"**
2. 创建新版本并发布
3. 确保应用状态为 **"已发布"**

## 快速权限申请链接

您也可以直接点击以下链接快速申请所需权限：

[一键申请飞书API权限](https://open.feishu.cn/app/cli_a8f03721cff45013/auth?q=im:chat:readonly,im:chat,im:chat.group_info:readonly,im:chat:read&op_from=openapi&token_type=tenant)

*注意：请将链接中的 `cli_a8f03721cff45013` 替换为您自己的 App ID*

## 验证配置

权限配置完成后，您可以：

1. 重新运行测试工具验证：
   ```bash
   python test_feishu_credentials.py
   ```

2. 或者在应用设置中重新进行连接测试

## 常见问题

### Q1: 权限申请被拒绝怎么办？

**A:** 重新申请时提供更详细的使用说明，说明是用于内部工作汇报自动化，不涉及敏感信息。

### Q2: 应用发布失败怎么办？

**A:** 检查应用信息是否完整，包括应用描述、图标、隐私政策等必填项。

### Q3: 权限配置后仍然连接失败？

**A:** 确保：
- 所有必需权限都已添加
- 权限审核已通过
- 应用已成功发布
- 等待几分钟让配置生效

## 权限说明

### im:chat:readonly
- **用途**: 获取群聊基本信息
- **必要性**: 验证群聊ID有效性
- **风险级别**: 低

### im:chat
- **用途**: 发送消息到群聊
- **必要性**: 核心功能，发送汇报内容
- **风险级别**: 中

### im:chat.group_info:readonly
- **用途**: 获取群聊详细信息
- **必要性**: 确认群聊权限和状态
- **风险级别**: 低

### im:chat:read
- **用途**: 读取群聊消息
- **必要性**: 可选，用于检查重复提交
- **风险级别**: 中

## 安全建议

1. **最小权限原则**: 只申请必要的权限
2. **定期检查**: 定期检查权限使用情况
3. **安全存储**: 妥善保管 App Secret，不要泄露
4. **访问控制**: 限制应用的使用范围和人员

## 技术支持

如果您在配置过程中遇到问题，可以：

1. 查看 [飞书开放平台文档](https://open.feishu.cn/document/)
2. 联系飞书技术支持
3. 参考 [权限配置故障排除指南](https://open.feishu.cn/document/uAjLw4CM/ugTN1YjL4UTN24CO1UjN/trouble-shooting/how-to-fix-the-99991672-error)

---

配置完成后，您就可以正常使用飞书自动提交功能了！